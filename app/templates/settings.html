{% extends "base.html" %}
{% block content %}
<div class="settings">
  <h1>Settings</h1>

  <div class="card">
    <h2>Users</h2>
    <form method="post" action="/settings/add_user" class="row">
      <input name="display_name" placeholder="New user name" required>
      <button class="primary">Add</button>
    </form>
    <div class="user-list">
      {% for u in users %}
        <details class="user-details">
          <summary>{{u.display_name}}</summary>
          <form method="post" action="/settings/update" class="grid">
            <input type="hidden" name="user_id" value="{{u.id}}">
            {% set st = u.settings or namespace() %}
            <fieldset>
              <legend>Addition</legend>
              <label><input type="checkbox" name="add_enabled" {% if u.settings and u.settings.add_enabled %}checked{% endif %}> Enabled</label>
              <div class="row">
                <label>Smallest number <input type="number" name="add_min" value="{{ u.settings.add_min if u.settings else 0 }}"></label>
                <label>Largest number <input type="number" name="add_max" value="{{ u.settings.add_max if u.settings else 12 }}"></label>
              </div>
            </fieldset>

            <fieldset>
              <legend>Subtraction</legend>
              <label><input type="checkbox" name="sub_enabled" {% if u.settings and u.settings.sub_enabled %}checked{% endif %}> Enabled</label>
              <div class="row">
                <label>Smallest number <input type="number" name="sub_min" value="{{ u.settings.sub_min if u.settings else 0 }}"></label>
                <label>Largest number <input type="number" name="sub_max" value="{{ u.settings.sub_max if u.settings else 12 }}"></label>
              </div>
            </fieldset>

            <fieldset>
              <legend>Multiplication</legend>
              <label><input type="checkbox" name="mul_enabled" {% if u.settings and u.settings.mul_enabled %}checked{% endif %}> Enabled</label>
              <div class="row">
                <label>First factor min <input type="number" name="mul_a_min" value="{{ u.settings.mul_a_min if u.settings else 1 }}"></label>
                <label>First factor max <input type="number" name="mul_a_max" value="{{ u.settings.mul_a_max if u.settings else 12 }}"></label>
              </div>
              <div class="row">
                <label>Second factor min <input type="number" name="mul_b_min" value="{{ u.settings.mul_b_min if u.settings else 1 }}"></label>
                <label>Second factor max <input type="number" name="mul_b_max" value="{{ u.settings.mul_b_max if u.settings else 12 }}"></label>
              </div>
            </fieldset>

            <fieldset>
              <legend>Division</legend>
              <label><input type="checkbox" name="div_enabled" {% if u.settings and u.settings.div_enabled %}checked{% endif %}> Enabled</label>
              <div class="row">
                <label>Largest dividend <input type="number" name="div_dividend_max" value="{{ u.settings.div_dividend_max if u.settings else 144 }}"></label>
              </div>
              <div class="row">
                <label>Divisor min <input type="number" name="div_divisor_min" value="{{ u.settings.div_divisor_min if u.settings else 1 }}"></label>
                <label>Divisor max <input type="number" name="div_divisor_max" value="{{ u.settings.div_divisor_max if u.settings else 12 }}"></label>
              </div>
            </fieldset>

            <div class="row right">
              <button class="primary">Save</button>
            </div>
          </form>
          <form method="post" action="/settings/delete_user" onsubmit="return confirm('Delete {{u.display_name}}? This removes their history too.');">
            <input type="hidden" name="user_id" value="{{u.id}}">
            <button class="danger">Delete user</button>
          </form>
        </details>
      {% endfor %}
    </div>
  </div>

  <p><a href="/">Back to login</a></p>
</div>
{% endblock %}