{% extends "base.html" %}
{% block content %}
<div class="layout centered">
  <section class="main-col">
    <div class="row space-between">
      <h1 class="title">Who’s playing?</h1>
    </div>

    <div class="user-grid">
      {% for u in users %}
        {% set r = recent.get(u.id) if recent else None %}
        <form method="post" action="/login" class="user-tile-form">
          <input type="hidden" name="user_id" value="{{ u.id }}">
          <button class="user-card" type="submit">
            <div class="user-name">{{ u.display_name }}</div>
            {% if r %}
              <div class="user-sub user-sub1">Last: {{ r.type|capitalize }}{% if r.level %} • Level <span class="lvl-num" data-level="{{ r.level }}">{{ r.level }}</span>{% endif %}</div>
              <div class="user-sub user-sub2">{{ (r.elapsed_ms // 60000) }}:{{ "%02d"|format((r.elapsed_ms // 1000) % 60) }}{% if r.star %} • <span class="user-star" title="Star earned">★</span>{% endif %}</div>
            {% else %}
              <div class="user-sub muted">No drills yet — be the first!</div>
            {% endif %}
          </button>
        </form>
      {% endfor %}
    </div>

    <div class="card" style="margin-top:16px;">
      <form method="post" action="/user/add" class="row">
        <input type="text" name="display_name" placeholder="New player name">
        <button class="btn btn-primary">Add and start</button>
      </form>
      <div style="margin-top:10px;"><a href="/admin" class="btn btn-secondary">Admin</a></div>
    </div>
  </section>

</div>
{% endblock %}

