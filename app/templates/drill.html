{% extends "base.html" %}
{% block content %}
<div class="layout">
  <section class="main-col">
    <div class="row space-between">
      <a class="muted-link" href="/dashboard">← Dashboard</a>
    </div>

    <div id="settings-human" class="note">{{ settings_human }}</div>

    <div class="eq-meta">
      <div class="timer" id="timer">0:00</div>
      <div class="progress">Question <span id="q-done">0</span>/20</div>
    </div>

    <div class="level-banner">
      Level <span id="level-num">{{ level_num }}</span>: <span class="level-label">{{ settings_human }}</span>
    </div>

    <div id="equation" class="equation">
      <div class="eq-col">
        <div id="num-a" class="eq-num">12</div>
        <div class="eq-row">
          <div id="op" class="eq-op">×</div>
          <div id="num-b" class="eq-num">7</div>
        </div>
        <div class="eq-line"></div>
        <form id="answer-form" class="answer-form">
          <input id="answer" type="number" inputmode="numeric" autocomplete="off" placeholder="answer" class="answer-input">
          <button type="submit" class="btn btn-primary enter-btn">Enter ⏎</button>
        </form>
      </div>
    </div>

    <div id="overlay" class="overlay hidden">
      <div id="overlay-content" class="overlay-box">1 × 2 = 2</div>
    </div>

    <div id="helper" class="helper"></div>

    <!-- Celebration overlay (shown at end of drill) -->
    <div id="celebrate" class="cele-overlay hidden">
      <div class="cele-card">
        <div id="cele-emoji" class="cele-emoji">⭐</div>
        <h2 id="cele-title" class="cele-title">Great job!</h2>
        <div id="cele-sub" class="cele-sub">Drill complete — ready for another round?</div>
        <div id="cele-stats" class="cele-stats">Time 0:00 • Score 20/20</div>
        <div class="cele-stars-wrap">
          <div class="cele-stars-label">Last five stars</div>
          <div id="cele-stars" class="cele-stars">☆☆☆☆☆</div>
        </div>
        <div id="finish-actions" class="cele-actions">
          <form id="again-form" method="post" action="/start">
            <input type="hidden" name="drill_type" value="{{ drill_type }}">
            <button id="play-again-btn" class="btn btn-primary">Play again</button>
          </form>
          <form id="nextlvl-form" class="hidden" method="post" action="/start">
            <input type="hidden" name="drill_type" value="{{ drill_type }}">
            <button class="btn btn-primary">Start next level</button>
          </form>
          <a id="home-btn" class="btn btn-secondary" href="/dashboard">Dashboard</a>
        </div>
      </div>
    </div>

    <script>
      window.DRILL = {
        type: "{{ drill_type }}",
        target: {{ target_count }},
        first: {prompt: "{{ first_prompt }}", answer: {{ first_answer }}, tts: "{{ first_tts }}"},
        level: {{ level_num or 1 }}
      };
    </script>
  </section>

  {% include "components/_sidebar.html" %}
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/drill.css">
{% endblock %}
{% block extra_js %}
<script src="/static/js/drill.js"></script>
{% endblock %}
