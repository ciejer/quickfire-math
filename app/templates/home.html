{% extends "base.html" %}
{% block content %}
<div class="layout">
  <section class="main-col">
    <div class="row space-between">
      <h1 class="title">Kia ora, {{ user.display_name }}</h1>
      <a class="muted-link" href="/">← Back</a>
    </div>

    <!-- Choose a drill: merged level+stars in big 2-up cards -->
    <form method="post" action="/start" class="chooser" id="choose-form">
      <label>Choose a drill</label>
      <div class="op-cards" id="op-cards">
        <label class="op-card" id="card-addition">
          <input type="radio" name="drill_type" value="addition" required>
          <div class="op-title">Addition</div>
          <div class="op-level" id="level-addition">Level —</div>
          <div class="op-stars" id="stars-addition">☆☆☆☆☆</div>
          <div class="op-note"><span class="badge" id="badge-addition">3 of last 5 stars → level up</span></div>
        </label>

        <label class="op-card" id="card-subtraction">
          <input type="radio" name="drill_type" value="subtraction" required>
          <div class="op-title">Subtraction</div>
          <div class="op-level" id="level-subtraction">Level —</div>
          <div class="op-stars" id="stars-subtraction">☆☆☆☆☆</div>
          <div class="op-note"><span class="badge" id="badge-subtraction">3 of last 5 stars → level up</span></div>
        </label>

        <label class="op-card" id="card-multiplication">
          <input type="radio" name="drill_type" value="multiplication" required>
          <div class="op-title">Multiplication</div>
          <div class="op-level" id="level-multiplication">Level —</div>
          <div class="op-stars" id="stars-multiplication">☆☆☆☆☆</div>
          <div class="op-note"><span class="badge" id="badge-multiplication">3 of last 5 stars → level up</span></div>
        </label>

        <label class="op-card" id="card-division">
          <input type="radio" name="drill_type" value="division" required>
          <div class="op-title">Division</div>
          <div class="op-level" id="level-division">Level —</div>
          <div class="op-stars" id="stars-division">☆☆☆☆☆</div>
          <div class="op-note"><span class="badge" id="badge-division">3 of last 5 stars → level up</span></div>
        </label>
      </div>
      <button class="btn btn-primary">Start</button>
    </form>

    <details class="expander">
      <summary>Reports</summary>
      <div class="reports">
        <h3>Multiplication</h3>
        <div id="report-mul" class="heatmap"></div>
        <h3>Addition (0–20)</h3>
        <div id="report-add" class="heatmap"></div>
        <h3>Subtraction (0–20, larger − smaller)</h3>
        <div id="report-sub" class="heatmap"></div>
      </div>
    </details>
  </section>

  <aside class="news-col">
    <div class="stats-head">Drills finished today</div>
    <ul id="stats-list" class="stats-list">
      <li>Total: <strong>0</strong></li>
      <li>Addition: <strong>0</strong></li>
      <li>Subtraction: <strong>0</strong></li>
      <li>Multiplication: <strong>0</strong></li>
      <li>Division: <strong>0</strong></li>
    </ul>

    <div class="news-head">Your newsfeed</div>
    <div id="feed-list">
      {% if drills %}
        {% for d in drills %}
        <div class="news-item">
          <div class="news-time">{{ d.created_at.strftime("%A %I:%M %p") }}</div>
          <div class="news-settings">{{ d.settings_snapshot }}</div>
          <div class="news-result">{{ (d.elapsed_ms//60000) }} min {{ ((d.elapsed_ms//1000)%60) }} secs</div>
        </div>
        {% endfor %}
      {% else %}
        <div class="news-empty">No drills yet — hit Start.</div>
      {% endif %}
    </div>
  </aside>
</div>
{% endblock %}
